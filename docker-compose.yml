version: "3.4"

# Include all required services configuration
# Ensure a few things are modified:
# 1. ENV vars
# 2. Volume mounts (for where you would like volumes mounted on your host)
# 3. Decide if you would like to mount /config on each service so you can keep a copy on your host of the config and make changes manually if necessary (outside of container)
services:
  # Front-end plex (reverse-proxy)
  webserver:
    container_name: webserver
    image: nginx:mainline-alpine
    volumes:
      - web-root:/var/www/html
      - ./nginx:/etc/nginx/conf.d
    depends_on:
      - plex
    ports:
      - 80:80
    restart: unless-stopped
    networks:
      - media-server-network
  # NOTE: Make sure that libraries are set to /tv and /movies in plex configuration
  plex:
    image: linuxserver/plex
    container_name: plex
    environment:
      - PUID=1000
      - PGID=1000
      - VERSION=docker
      - UMASK_SET=022 #optional
    volumes:
      - /home/ben/mediaserver/plex:/config # Change path for volume mount
      - /media/plex/tv:/tv # Change path for volume mount
      - /media/plex/movies:/movies # Change path for volume mount
    ports:
      - 32400:32400
    networks:
      - media-server-network
    restart: unless-stopped
  # NOTE: Make sure to set download directory to /downloads
  deluge:
    image: linuxserver/deluge
    container_name: deluge
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New York
      - UMASK_SET=022 #optional
      - DELUGE_LOGLEVEL=error #optional
    volumes:
      - /home/ben/mediaserver/deluge:/config # Change path for volume mount
      - /media/downloads:/downloads # Change path for volume mount
    ports:
      - 8112:8112
    networks:
      - media-server-network
    restart: unless-stopped
  # NOTE: With Sonarr, when setting up downloader, make sure ip address is "deluge:8112"
  sonarr:
    image: linuxserver/sonarr
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New York
      - UMASK_SET=022 #optional
    volumes:
      - /home/ben/mediaserver/sonarr:/config # Change path for volume mount
      - /media/plex/tv:/tv # Change path for volume mount
      - /media/downloads:/downloads # Change path for volume mount
    ports:
      - 8989:8989
    networks:
      - media-server-network
    restart: unless-stopped
  # NOTE: Similar to Sonarr, when setting up downloader make sure to enter "deluge:8112" for the host and port respectively
  radarr:
    image: linuxserver/radarr
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New York
      - UMASK_SET=022 #optional
    volumes:
      - /home/ben/mediaserver/radarr:/config # Change path for volume mount
      - /media/plex/movies:/movies # Change path for volume mount
      - /media/downloads:/downloads # Change path for volume mount
    ports:
      - 7878:7878
    networks:
      - media-server-network
    restart: unless-stopped
  # NOTE: With Jackett, ensure blackhole directory is setup at /downloads
  # Also: Ensure trackers are setup from config
  jackett:
    image: linuxserver/jackett
    container_name: jackett
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New York
      - AUTO_UPDATE=true #optional
    volumes:
      - /home/ben/mediaserver/jackett:/config # Change path for volume mount
      - /media/downloads:/downloads # Change path for volume mount
    ports:
      - 9117:9117
    networks:
      - media-server-network
    restart: unless-stopped

volumes:
  web-root:
    driver: local

# NOTE: It is very important that if you are also running a OpenVPN service on the host, that you include the EXACT subnet address for the network interface to use.
#       The reason for this is to avoid overlapping of IPv4 addresses. This way as long as your openVPN service is not using the 172.16.57.0/24 subnet, you should not have any overlap.
networks:
  media-server-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.16.57.0/24